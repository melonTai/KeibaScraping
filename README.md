# KeibaScraping {ignore = toc}
-----
スクレイピングによりレースや馬データを収集する

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [環境設定](#環境設定)
- [使用方法](#使用方法)
  - [scrape_race.py](#scrape_racepy)
  - [scrape_horse.py](#scrape_horsepy)
  - [scrape_odds.py](#scrape_oddspy)
  - [scrape_returns.py](#scrape_returnspy)
  - [shutuba_related_info.py](#shutuba_related_infopy)
- [レース場id](#レース場id)

<!-- /code_chunk_output -->

# 環境設定
```
pip install -r requirements.txt
```
# 使用方法

## scrape_race.py
過去のレース結果を取得し、年ごとにcsvで取得

下記サイトの結果/払い戻しの欄をそのまま取得している．
https://db.netkeiba.com/race/202006040911/

csv
| |着順|枠番|馬番|馬名|性齢|斤量|騎手|タイム|着差|ﾀｲﾑ指数|通過|上り|単勝|人気|馬体重|調教ﾀｲﾑ|厩舎ｺﾒﾝﾄ|備考|調教師|馬主|賞金(万円)|horse_id|jockey_id|race_id|title|date|回_開催_日|階級|条件|field|turn|in_out|dist|weather|condition|start_time|
|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|
|0|1|5|10|グランアレグリア|牝4|55.0|ルメール|1:08.3| |**|15-15|33.6|2.2|1.0|504(+12)| | | |[東]藤沢和雄|サンデーレーシング|13,340.2|2016104532|5339|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|1|2|2|3|ダノンスマッシュ|牡5|57.0|川田将雅|1:08.6|2|**|4-4|35.0|5.1|3.0|472(+2)| | | |[西]安田隆行|ダノックス|5,297.2|2015102377|1088|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|2|3|8|16|アウィルアウェイ|牝4|55.0|松山弘平|1:08.7|1/2|**|16-16|33.7|60.9|10.0|478(-4)| | | |[西]高野友和|吉田勝己|3,348.6|2016104721|1126|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|3|4|4|7|ミスターメロディ|牡5|57.0|福永祐一|1:08.8|1/2|**|7-3|35.0|23.7|7.0|492(-2)| | | |[西]藤原英昭|グリーンフィールズ|2,000.0|2015110096|1014|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|4|5|8|15|クリノガウディー|牡4|57.0|三浦皇成|1:09.0|1|**|13-13|34.6|46.1|9.0|490(0)| | | |[西]藤沢則雄|栗本博晴|1,300.0|2016103690|1122|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|5|6|7|13|レッドアンシェル|牡6|57.0|Ｍ．デム|1:09.0|アタマ|**|11-11|34.7|13.3|4.0|474(-4)| | | |[西]庄野靖志|東京ホースレーシング| |2014105982|5212|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|6|7|3|5|メイショウグロッケ|牝6|55.0|浜中俊|1:09.1|1/2|**|5-7|35.4|101.0|12.0|460(-4)| | | |[西]荒川義之|松本好隆| |2014103524|1115|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|7|8|1|1|ダイメイプリンセス|牝7|55.0|秋山真一|1:09.1|ハナ|**|8-9|35.1|271.7|15.0|504(+2)| | | |[西]森田直行|宮本孝一| |2013101042|1019|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|8|9|3|6|ライトオンキュー|牡5|57.0|古川吉洋|1:09.1|ハナ|**|5-6|35.4|16.4|6.0|512(0)| | | |[西]昆貢|ゴドルフィン| |2015101599|1015|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|9|10|1|2|モズスーパーフレア|牝5|55.0|松若風馬|1:09.3|1|**|1-1|36.5|3.9|2.0|502(-6)| | | |[西]音無秀孝|キャピタル・システム| |2015110017|1154|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|10|11|7|14|エイティーンガール|牝4|55.0|池添謙一|1:09.3|ハナ|**|14-13|34.8|37.1|8.0|448(-8)| | | |[西]飯田祐史|中山泰志| |2016103143|1032|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|11|12|2|4|キングハート|牡7|57.0|北村宏司|1:09.3|クビ|**|8-7|35.3|383.0|16.0|500(-4)| | | |[東]星野忍|増田陽一| |2013101315|1043|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|12|13|5|9|ダイアトニック|牡5|57.0|横山典弘|1:09.7|2.1/2|**|8-10|35.7|14.5|5.0|474(-2)| | | |[西]安田隆行|シルクレーシング| |2015103057|660|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|13|14|4|8|ダイメイフジ|牡6|57.0|菱田裕二|1:09.7|アタマ|**|11-11|35.4|156.2|13.0|506(-14)| | | |[西]森田直行|宮本昇| |2014102625|1144|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|14|15|6|11|ラブカンプー|牝5|55.0|斎藤新|1:09.8|1/2|**|3-4|36.4|214.5|14.0|448(-2)| | | |[西]森田直行|増田陽一| |2015100978|1178|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|
|15|16|6|12|ビアンフェ|牡3|55.0|藤岡佑介|1:10.3|3|**|2-2|37.5|67.1|11.0|560(0)| | | |[西]中竹和也|前田幸貴| |2017101832|1093|202006040911|第54回スプリンターズS(G1)|2020年10月4日|4回中山9日目|3歳以上オープン|(国際)(指)(定量)|芝|右 |外|1200|曇|良|15:40|

実行方法
```
python scrape_results.py [開始年] [終了年] [レース場id]
```

[レース場id](#レース場id)

## scrape_horse.py
scrape_race.pyで取得したレース結果csvを読み取り、出場している馬の戦績を取得する

下記サイトの結果/競争成績の欄をそのまま取得している．
https://db.netkeiba.com/horse/2016100007/

csv
| |日付|開催|天気|R|レース名|映像|頭数|枠番|馬番|オッズ|人気|着順|騎手|斤量|距離|馬場|馬場指数|タイム|着差|ﾀｲﾑ指数|通過|ペース|上り|馬体重|厩舎ｺﾒﾝﾄ|備考|勝ち馬(2着馬)|賞金|race_id|jockey_id|horse_id|horse_title|
|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|
|0|2021/01/27|川崎|曇|6|C2四　五六| |12|8|11|8.9|4|9|笹川翼|56.0|ダ1400|不|**|1:34.0|1.5|**|7-11-7-6|38.7-41.7|42.2|464(-7)| | |エリープラネット| |202145012706|5524.0|2016100007| |
|1|2021/01/03|川崎|晴|6|弁才天賞| |12|7|10|10.7|6|5|笹川翼|56.0|ダ1400|良|**|1:32.2|0.9|**|4-5-5-3|38.3-40.9|41.2|471(-3)| | |イントゥザスカイ|12.0|202145010306|5524.0|2016100007| |
|2|2020/12/14|川崎|曇|8|C1七　八| |12|4|4|7.6|4|8|伊藤裕人|56.0|ダ1400|良|**|1:32.6|1.9|**|12-12-5-6|38.9-39.9|40.9|474(-15)| | |シークザトゥルース| |202045121408| |2016100007| |
|3|2020/11/02|笠松|雨|9|イチョウ賞| |9|2|2|3.1|2|1|大原浩司|56.0|ダ1400|良|**|1:29.0|-0.4|**|4-4-3|0.0-40.4|38.9|489(+7)| | |(スーサンブルース)|34.0|202047110209|5368.0|2016100007| |
|4|2020/10/20|笠松|晴|10|フォーマルハウト賞| |8|1|1|6.6|3|2|大原浩司|56.0|ダ1600|良|**|1:44.9|1.5|**|5-3-2|0.0-40.8|41.1|482(+1)| | |グレイトデピュティ|7.9|202047102010|5368.0|2016100007| |
|5|2020/10/05|笠松|晴|10|馬籠賞| |8|8|8|9.7|4|2|大原浩司|56.0|ダ1400|良|**|1:28.8|0.4|**|1-1-1|0.0-39.5|39.9|481(-2)| | |カッシーニ|7.9|202047100510|5368.0|2016100007| |
|6|2020/09/23|笠松|晴|11|流れ星特別| |6|4|4|2.4|1|3|大塚研司|57.0|ダ1400|良|**|1:29.8|1.0|**|3-4-3|0.0-38.0|38.7|483(+4)| | |ロバストミノル|4.8|202047092311|5142.0|2016100007| |
|7|2020/09/09|笠松|雨|10|天生峠特別| |9|6|6|1.8|1|5|大塚研司|57.0|ダ1400|良|**|1:32.6|3.0|**|4-3-3|0.0-39.3|42.0|479(+1)| | |シオジスター|2.4|202047090910|5142.0|2016100007| |
|8|2020/08/28|笠松|曇|9|ひるがの高原特別| |10|8|10|7.5|4|9|大塚研司|56.0|ダ1600|良|**|1:45.8|2.9|**|9-9-9|0.0-38.9|39.5|478(0)| | |ヒルノデンハーグ| |202047082809|5142.0|2016100007| |
|9|2020/05/20|笠松|晴|12|飛水峡特別| |11|8|11|1.5|1|3|深澤杏花|52.0|ダ1400|良|**|1:28.5|0.8|**|5-3-2|0.0-38.6|38.9|478(+3)| | |ナラ|4.4|202047052012| |2016100007| |
|10|2020/04/28|笠松|晴|12|麗春特別| |8|5|5|7.3|3|1|深澤杏花|52.0|ダ1400|良|**|1:26.7|-0.8|**|1-1-1|0.0-39.2|39.2|475(0)| | |(ベルフォルテ)|44.0|202047042812| |2016100007| |
|11|2020/04/15|笠松|晴|6|サラ系B5組| |9|3|3|1.3|1|1|深澤杏花|52.0|ダ1400|良|**|1:28.4|-1.1|**|3-3-2|0.0-39.6|38.8|475(-1)| | |(ライトリー)|26.0|202047041506| |2016100007| |
|12|2020/04/02|笠松|晴|5|サラ系B4組| |0|5|5| | |除|深澤杏花|52.0|ダ1600|重|**| | |**| | | |474(-2)| | | | |202047040205| |2016100007| |
|13|2020/03/17|笠松|晴|11|花月特別| |10|8|10|2.9|1|2|大塚研司|56.0|ダ1800|良|**|1:57.1|0.2|**|2-2-1-1|0.0-39.1|39.1|476(+1)| | |ジュンケンジー|10.2|202047031711|5142.0|2016100007| |
|14|2020/03/06|笠松|晴|10|マックル賞| |10|6|6|1.3|1|1|大塚研司|57.0|ダ1400|良|**|1:27.6|-1.0|**|1-1-1|0.0-39.1|39.1|475(+9)| | |(ヤマニンシレーナ)|26.0|202047030610|5142.0|2016100007| |
|15|2020/02/21|笠松|晴|10|向春特別| |10|6|6|1.6|1|2|大塚研司|56.0|ダ1400|良|**|1:28.6|0.1|**|2-2-2|0.0-39.6|39.5|466(+3)| | |ベルフォルテ|7.9|202047022110|5142.0|2016100007| |
|16|2020/02/07|笠松|晴|4|サラ系C6組| |8|1|1|1.3|1|1|大塚研司|56.0|ダ1400|良|**|1:26.9|-1.1|**|1-1-1|0.0-38.4|38.4|463(-2)| | |(キリンノツバサ)|24.0|202047020704|5142.0|2016100007| |
|17|2020/01/24|笠松|晴|9|若菜特別| |9|7|7|6.4|3|2|大塚研司|56.0|ダ1400|稍|**|1:28.2|0.4|**|4-4-3|0.0-39.3|38.9|465(+4)| | |オクラ|7.9|202047012409|5142.0|2016100007| |
|18|2020/01/09|笠松|晴|6|サラ系C10組| |8|6|6|2.7|2|1|大塚研司|56.0|ダ1400|稍|**|1:28.2|-1.3|**|1-1-1|0.0-37.8|37.8|461(-1)| | |(コルネット)|24.0|202047010906|5142.0|2016100007| |
|19|2019/12/31|笠松|晴|9|OKB大垣共立銀行ピ| |9|2|2|4.1|2|6|向山牧|56.0|ダ1400|重|**|1:28.8|1.7|**|9-8-7|0.0-38.2|38.7|462(+4)| | |サンマルフラッシュ| |201947123109|410.0|2016100007| |
|20|2019/12/03|笠松|晴|5|サラ系C18組| |8|5|5|1.0|1|1|向山牧|56.0|ダ1400|稍|**|1:30.7|-0.8|**|1-1-1|0.0-38.7|38.7|458(+4)| | |(キチロクアユノ)|20.0|201947120305|410.0|2016100007| |
|21|2019/11/19|笠松|晴|4|サラ系C15・18組| |7|1|1|4.0|2|2|向山牧|56.0|ダ1400|良|**|1:29.5|0.1|**|1-1-1|0.0-39.3|39.4|454(+4)| | |オルオル|4.6|201947111904|410.0|2016100007| |
|22|2019/11/06|笠松|晴|4|サラ系C16組| |9|1|1|6.6|3|2|向山牧|56.0|ダ1400|良|**|1:29.6|0.0|**|1-1-1|0.0-38.8|38.8|450(0)| | |タマモケトル|4.6|201947110604|410.0|2016100007| |
|23|2019/10/23|笠松|晴|5|サラ系3歳4組| |8|2|2|5.1|2|4|向山牧|56.0|ダ1400|稍|**|1:29.5|1.1|**|5-4-4|0.0-37.5|38.0|450(+1)| | |ムーンオブバローダ|1.9|201947102305|410.0|2016100007| |
|24|2019/10/10|笠松|晴|2|サラ系3歳4組| |8|6|6|8.8|3|2|向山牧|56.0|ダ1400|良|**|1:28.5|0.3|**|2-2-2|0.0-38.3|38.0|449(+1)| | |マルカノーベル|6.3|201947101002|410.0|2016100007| |
|25|2019/09/26|笠松|晴|1|サラ系3歳4組| |8|3|3|8.2|4|3|向山牧|56.0|ダ1400|良|**|1:31.0|0.7|**|2-2-2|0.0-37.7|38.2|448(-1)| | |アレグレユミティー|2.7|201947092601|410.0|2016100007| |
|26|2019/09/11|笠松|晴|3|サラ系3歳6組| |10|4|4|6.3|2|1|佐藤友則|56.0|ダ1400|良|**|1:29.6|0.0|**|4-3-3|0.0-39.1|38.7|449(-4)| | |(エイシントルーパー)|27.0|201947091103|5268.0|2016100007| |
|27|2019/08/30|笠松|雨|3|大石幸司生誕記念| |10|6|6|3.8|2|1|向山牧|56.0|ダ1400|重|**|1:29.4|-1.4|**|2-1-1|0.0-39.0|39.0|453(-3)| | |(アヴァターラ)|27.0|201947083003|410.0|2016100007| |
|28|2019/08/15|笠松|曇|2|清水碧生誕記念| |8|2|2|19.5|7|3|松本剛志|56.0|ダ1400|良|**|1:30.4|0.2|**|4-4-4|0.0-41.0|40.6|456(+20)| | |カシマエンペラー|2.7|201947081502| |2016100007| |
|29|2019/05/04|2東京5|晴|3|3歳未勝利| |15|7|12|649.5|15|13|岩部純二|56.0|ダ1600|稍|**|1:42.1|4.3|**|14-14|36.2-36.8|39.1|436(-2)| | |ダイスアキャスト| |201905020503|726.0|2016100007| |
|30|2019/04/27|2東京3|曇|2|3歳未勝利| |16|7|14|331.6|16|13|岩部純二|56.0|ダ1400|稍|**|1:29.2|1.9|**|14-16|36.9-37.4|37.4|438(-2)| | |ジーニー| |201905020302|726.0|2016100007| |
|31|2019/02/24|2中山2|晴|9|黄梅賞(500万下)| |11|6|7|544.0|11|11|岩部純二|56.0|芝1600|良|**|1:37.1|2.6|**|10-11-11|36.4-34.7|35.9|440(-6)| | |レノーア| |201906020209|726.0|2016100007| |ｖ
|32|2019/02/16|2京都7|曇|1|3歳未勝利| |13|4|4|205.8|12|11|水口優也|56.0|ダ1800|良|**|1:58.8|2.9|**|8-10-10-10|37.0-38.8|40.6|446(0)| | |メイショウイフウ| |201908020701|1133.0|2016100007| |
|33|2019/02/11|1東京5|曇|1|3歳未勝利| |16|7|14|221.9|14|10|岩部純二|56.0|ダ1400|良|**|1:30.2|1.9|**|16-16|37.3-38.1|37.5|446(0)| | |ホウオウクリスティ| |201905010501|726.0|2016100007| |


実行方法
```
python scrape_horse.py [開始年] [終了年] [レース場id]
```

## scrape_odds.py
過去レースの全馬券のオッズを取得

下記サイトのオッズの欄をそのまま取得している
https://race.netkeiba.com/odds/index.html?race_id=202006040911&rf=race_submenu

3連複の場合
csv
| |組み合わせ|オッズ|race_id|
|:----|:----|:----|:----|
|0|3-12-14|17.8|202005010101|
|1|1-3-14|22.9|202005010101|
|2|2-3-14|24.5|202005010101|
|3|1-2-14|30.9|202005010101|
|4|3-9-14|35.0|202005010101|
|5|1-12-14|36.1|202005010101|
|6|2-12-14|37.4|202005010101|
|7|1-2-3|42.4|202005010101|
|8|1-3-12|43.4|202005010101|
|9|3-7-14|43.8|202005010101|
|10|3-10-14|49.2|202005010101|

実行方法
```
python scrape_odds.py [開始年] [終了年] [レース場id]
```

[レース場id](#レース場id)

## scrape_returns.py
過去レースの当たり馬券の払い戻しを取得

下記サイトの結果/払い戻しの欄をそのまま取得している．
https://db.netkeiba.com/race/202006040911/

実行方法
```
python scrape_returns.py [開始年] [終了年] [レース場id]
```

## shutuba_related_info.py
予定されているレースの出場馬とその馬の過去戦歴，および，関連レースを取得する．

下記サイトの出馬表の欄をそのまま取得している．
https://race.netkeiba.com/race/shutuba.html?race_id=202105040211

実行時入力するレースidはurl中の
```
race_id=***
```
の部分を入力する．

実行方法
```
python shutuba_related_info.py [レースid]
```


# レース場id
|レース場|id|
|:---|:---|
|札幌|1|
|函館|2|
|福島|3|
|新潟|4|
|東京|5|
|中山|6|
|中京|7|
|京都|8|
|阪神|9|
|小倉|10|
|浦和|42|
|船橋|43|
|大井|44|
|川崎|45|
|門別|46|
|盛岡|47|
|水沢|48|
|金沢|49|
|笠松|50|
|名古屋|51|
|園田|52|
|姫路|53|
|高知|54|
|佐賀|55|
|帯広(ば)|56|
